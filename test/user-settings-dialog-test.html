<!--
Copyright 2017 Next Century Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>user-settings-dialog</title>
  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>
  <link rel="import" href="../user-settings-dialog.html">
</head>

<body>
  <test-fixture id="user-settings-dialog-fixture">
    <template>
      <user-settings-dialog></user-settings-dialog>
    </template>
  </test-fixture>

  <script>
    /* globals suite, setup, fixture, flush, test, assert */
    /* jshint -W030 */
    suite('user-settings-dialog tests', function() {
      var element;

      setup(function(done) {
        element = fixture('user-settings-dialog-fixture');
        element.blurImages = false;
        element.buildPopupDataFunction = function(searchParameters) {
          var object = {};
          if(searchParameters.a) {
            object.x = searchParameters.a;
          }
          if(searchParameters.b) {
            object.y = searchParameters.b;
          }
          if(searchParameters.c) {
            object.z = searchParameters.c;
          }
          return object;
        };
        element.buildStateDataFunction = function(searchParameters) {
          return {
            a: searchParameters.a || [],
            b: searchParameters.b || [],
            c: searchParameters.c || []
          };
        };
        element.emailAddress = '';
        element.processRequest = true;
        element.resetDatesDataFunction = function(searchParameters, startDateString) {
          if(startDateString) {
            searchParameters.startDate = startDateString;
          }
          return searchParameters;
        };
        element.cases = [];
        element.searchParameters = {};
        element.enableSearch = true;
        element.username = 'testUser';
        element.userId = '1';
        flush(done);
      });

      test('properties are set as expected', function() {
        assert.isFalse(element.blurImages);
        assert.isFunction(element.buildPopupDataFunction);
        assert.isFunction(element.buildStateDataFunction);
        assert.equal(element.emailAddress, '');
        assert.isUndefined(element.dataConfig);
        assert.isFalse(element.notifications);
        assert.isUndefined(element.notificationInterval);
        assert.isNull(element.notificationDate);
        assert.isTrue(element.processRequest);
        assert.isFunction(element.resetDatesDataFunction);
        assert.deepEqual(element.cases, []);
        assert.deepEqual(element.searchParameters, {});
        assert.isTrue(element.enableSearch);
        assert.equal(element.username, 'testUser');
        assert.equal(element.userId, '1');
        assert.isFalse(element.userLoading);
        assert.deepEqual(element._collapsedCases, []);
        assert.equal(element._emailInput, '');
        assert.isUndefined(element._handlingSearch);
        assert.isUndefined(element._isEmailInvalid);
      });

      test('does have settings button element', function() {
        var settingsButton = element.$$('#settingsButton');
        assert(settingsButton);
        assert.equal(settingsButton.icon, 'fa:cog');
        assert.isString(settingsButton.title);
      });

      test('does have closed settings dialog element', function() {
        var settingsDialog = element.$$('#settingsDialog');
        assert(settingsDialog);
        assert.isTrue(settingsDialog.fill);
        assert.equal(settingsDialog.header, 'User Settings');
        assert.isFalse(settingsDialog.modal);
        assert.isFalse(settingsDialog.opened);
      });

      test('does have closed delete case dialog element', function() {
        var deleteDialog = element.$$('#deleteCaseDialog');
        assert(deleteDialog);
        assert.isFalse(deleteDialog.fill);
        assert.equal(deleteDialog.header, '');
        assert.isTrue(deleteDialog.modal);
        assert.isFalse(deleteDialog.opened);
      });

      test('does have closed delete case data dialog element', function() {
        var deleteDialog = element.$$('#deleteCaseDataDialog');
        assert(deleteDialog);
        assert.isFalse(deleteDialog.fill);
        assert.equal(deleteDialog.header, '');
        assert.isTrue(deleteDialog.modal);
        assert.isFalse(deleteDialog.opened);
      });

      test('does show content if userId is defined', function(done) {
        element.cases = [{
          name: 'myCase',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{}}'
          }],
          sendEmailAlert: false
        }];
        flush(function() {
          assert.isNotNull(element.$$('paper-icon-button[title="Toggle Blur Images"]'));
          assert.isNotNull(element.$$('paper-dropdown-menu[label="Interval"]'));
          assert.isNull(element.$$('paper-input[label="Enter Email Address"]'));
          assert.isNull(element.$$('paper-icon-button[title="Save Email Address"]'));
          var cases = Polymer.dom(element.root).querySelectorAll('.case-item');
          assert.equal(cases.length, 1);
          assert.isNotNull(cases[0]);
          var caseDataList = Polymer.dom(element.root).querySelectorAll('.case-data-item');
          assert.equal(caseDataList.length, 1);
          assert.isNotNull(caseDataList[0]);
          var ironCollapses = Polymer.dom(element.root).querySelectorAll('iron-collapse');
          assert.equal(ironCollapses.length, 1);
          assert.isNotNull(ironCollapses[0]);
          assert.isTrue(ironCollapses[0].opened);
          var displays = Polymer.dom(element.root).querySelectorAll('terms-display');
          assert.equal(displays.length, 1);
          assert.isNotNull(displays[0]);
          assert.equal(displays[0].label, '');
          done();
        });
      });

      test('does not show content if userId is undefined', function(done) {
        element.cases = [{
          name: 'myCase',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{}}'
          }],
          sendEmailAlert: false
        }];
        element.userId = undefined;
        flush(function() {
          assert.isNull(element.$$('paper-icon-button[title="Toggle Blur Images"]'));
          assert.isNull(element.$$('paper-dropdown-menu[label="Interval"]'));
          assert.isNull(element.$$('paper-input[label="Enter Email Address"]'));
          assert.isNull(element.$$('paper-icon-button[title="Save Email Address"]'));
          var cases = Polymer.dom(element.root).querySelectorAll('.case-item');
          assert.equal(cases.length, 0);
          var caseDataList = Polymer.dom(element.root).querySelectorAll('.case-data-item');
          assert.equal(caseDataList.length, 0);
          var ironCollapses = Polymer.dom(element.root).querySelectorAll('iron-collapse');
          assert.equal(ironCollapses.length, 0);
          var displays = Polymer.dom(element.root).querySelectorAll('terms-display');
          assert.equal(displays.length, 0);
          done();
        });
      });

      test('does show email address input if enableEmailAddress is true', function(done) {
        element.enableEmailAddress = true;
        flush(function() {
          assert.isNotNull(element.$$('paper-input[label="Enter Email Address"]'));
          assert.isNotNull(element.$$('paper-icon-button[title="Save Email Address"]'));
          done();
        });
      });

      test('does enable search buttons if enableSearch is true', function(done) {
        element.cases = [{
          name: 'myCase',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{}}'
          }],
          sendEmailAlert: false
        }];
        flush(function() {
          var cases = Polymer.dom(element.root).querySelectorAll('.case-item');
          assert.equal(cases.length, 1);
          assert.isNotNull(cases[0]);
          var caseDataList = Polymer.dom(element.root).querySelectorAll('.case-data-item');
          assert.equal(caseDataList.length, 1);
          assert.isNotNull(caseDataList[0]);
          var displays = Polymer.dom(element.root).querySelectorAll('terms-display');
          assert.equal(displays.length, 1);
          assert.isNotNull(displays[0]);
          assert.isFalse(element.$$('paper-icon-button[icon="fa:search"]').disabled);
          done();
        });
      });

      test('does not enable search buttons if enableSearch is true', function(done) {
        element.enableSearch = false;
        element.cases = [{
          name: 'myCase',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{}}'
          }],
          sendEmailAlert: false
        }];
        flush(function() {
          var cases = Polymer.dom(element.root).querySelectorAll('.case-item');
          assert.equal(cases.length, 1);
          assert.isNotNull(cases[0]);
          var caseDataList = Polymer.dom(element.root).querySelectorAll('.case-data-item');
          assert.equal(caseDataList.length, 1);
          var displays = Polymer.dom(element.root).querySelectorAll('terms-display');
          assert.equal(displays.length, 1);
          assert.isNotNull(displays[0]);
          assert.isTrue(element.$$('paper-icon-button[icon="fa:search"]').disabled);
          done();
        });
      });

      test('save email address button is disabled if email address is invalid', function(done) {
        element.emailAddress = 'abc';
        element.enableEmailAddress = true;
        flush(function() {
          assert.isTrue(element.$$('paper-icon-button[title="Save Email Address"]').disabled);
          done();
        });
      });

      test('save email address button is not disabled if email address is valid', function(done) {
        element.emailAddress = 'abc@xyz.com';
        element.enableEmailAddress = true;
        flush(function() {
          assert.isFalse(element.$$('paper-icon-button[title="Save Email Address"]').disabled);
          done();
        });
      });

      test('_createDeleteCaseListener.onClick does delete the case at _deleteCaseIndex', function() {
        var listener = element._createDeleteCaseListener();
        assert.isObject(listener);
        assert.isFunction(listener.onClick);

        element.cases = [{
          name: 'case1',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{\"key1\":\"value1\"}}'
          }, {
            uiState: '{\"networkExpansion\":{},\"search\":{\"key2\":\"value2\"}}'
          }]
        }, {
          name: 'case2',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{\"key3\":\"value3\"}}'
          }, {
            uiState: '{\"networkExpansion\":{},\"search\":{\"key4\":\"value4\"}}'
          }]
        }];

        element._collapsedCases = [0, 1];
        element._deleteCaseIndex = 0;

        listener.onClick();

        assert.deepEqual(element.cases, [{
          name: 'case2',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{\"key3\":\"value3\"}}'
          }, {
            uiState: '{\"networkExpansion\":{},\"search\":{\"key4\":\"value4\"}}'
          }]
        }]);

        assert.deepEqual(element._collapsedCases, [1]);
      });

      test('_createDeleteCaseDataListener.onClick does delete the data with _deleteCaseIndex, _deleteCaseDataArray, and _deleteCaseDataIndex', function() {
        var listener = element._createDeleteCaseDataListener();
        assert.isObject(listener);
        assert.isFunction(listener.onClick);

        element.cases = [{
          name: 'case1',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{\"key1\":\"value1\"}}'
          }, {
            uiState: '{\"networkExpansion\":{},\"search\":{\"key2\":\"value2\"}}'
          }]
        }, {
          name: 'case2',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{\"key3\":\"value3\"}}'
          }, {
            uiState: '{\"networkExpansion\":{},\"search\":{\"key4\":\"value4\"}}'
          }]
        }];

        element._deleteCaseIndex = 0;
        element._deleteCaseDataArray = 'searchList';
        element._deleteCaseDataIndex = 0;

        listener.onClick();

        assert.deepEqual(element.cases, [{
          name: 'case1',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{\"key2\":\"value2\"}}'
          }]
        }, {
          name: 'case2',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{\"key3\":\"value3\"}}'
          }, {
            uiState: '{\"networkExpansion\":{},\"search\":{\"key4\":\"value4\"}}'
          }]
        }]);

        element._deleteCaseIndex = 1;
        element._deleteCaseDataIndex = 1;

        listener.onClick();

        assert.deepEqual(element.cases, [{
          name: 'case1',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{\"key2\":\"value2\"}}'
          }]
        }, {
          name: 'case2',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{\"key3\":\"value3\"}}'
          }]
        }]);
      });

      test('_createSearchParameters does return a new searchParameters object using buildStateDataFunction and resetSearchDateFunction', function() {
        assert.deepEqual(element._createSearchParameters('{\"search\":{\"a\":[1],\"b\":[2,3]}}', {}, new Date('September 01, 2017')), {
          a: [1],
          b: [2, 3],
          c: [],
          startDate: 'September 01, 2017'
        });
      });

      test('_createSearchParameters does override a previous date', function() {
        element.buildStateDataFunction = function(searchParameters) {
          return {
            startDate: searchParameters.startDate
          };
        };

        assert.deepEqual(element._createSearchParameters('{\"search\":{\"startDate\":\"previousDate\"}}', {}, new Date('September 01, 2017')), {
          startDate: 'September 01, 2017'
        });
      });

      test('_createSearchParameters does use config', function() {
        var called = false;
        element.buildStateDataFunction = function(searchParameters, config) {
          assert.deepEqual(config, {
            key: 'value'
          });
          called = true;
          return {};
        };

        element._createSearchParameters('{\"search\":{}}', {
          key: 'value'
        }, new Date('September 01, 2017'));
        assert.isTrue(called);
      });

      test('_deleteNotificationDate does not delete the notificationDate if _handlingSearch is true', function() {
        element.notificationDate = new Date('September 01, 2017');
        element._handlingSearch = true;
        element._deleteNotificationDate();
        assert.deepEqual(element.notificationDate, new Date('September 01, 2017'));
      });

      test('_deleteNotificationDate does delete the notificationDate if _handlingSearch is false', function() {
        element.notificationDate = new Date('September 01, 2017');
        element._handlingSearch = false;
        element._deleteNotificationDate();
        assert.equal(element.notificationDate, null);
      });

      test('_formatDate does return a date string', function() {
        assert.equal(element._formatDate(new Date('September 01, 2017')), 'September 01, 2017');
        assert.equal(element._formatDate(null), '');
      });

      test('_getCaseStyleClass does return as expected', function() {
        assert.equal(element._getCaseStyleClass(3, []), 'expand');
        assert.equal(element._getCaseStyleClass(3, [1]), 'expand');
        assert.equal(element._getCaseStyleClass(3, [1, 2]), 'expand');
        assert.equal(element._getCaseStyleClass(3, [3]), 'collapse');
        assert.equal(element._getCaseStyleClass(3, [1, 3]), 'collapse');
        assert.equal(element._getCaseStyleClass(3, [3, 1]), 'collapse');
      });

      test('_getCaseTitleTooltip does return as expected', function() {
        assert.equal(element._getCaseTitleTooltip(3, []), 'Click to Collapse Case');
        assert.equal(element._getCaseTitleTooltip(3, [1]), 'Click to Collapse Case');
        assert.equal(element._getCaseTitleTooltip(3, [1, 2]), 'Click to Collapse Case');
        assert.equal(element._getCaseTitleTooltip(3, [3]), 'Click to Expand Case');
        assert.equal(element._getCaseTitleTooltip(3, [1, 3]), 'Click to Expand Case');
        assert.equal(element._getCaseTitleTooltip(3, [3, 1]), 'Click to Expand Case');
      });

      test('_getCheckboxIcon does return as expected', function() {
        assert.equal(element._getCheckboxIcon(false), 'check-box-outline-blank');
        assert.equal(element._getCheckboxIcon(true), 'check-box');
      });

      test('_getEmailAddressButtonIsDisabled does return as expected', function() {
        assert.isTrue(element._getEmailAddressButtonIsDisabled('', true));
        assert.isTrue(element._getEmailAddressButtonIsDisabled('', false));
        assert.isTrue(element._getEmailAddressButtonIsDisabled('test', true));
        assert.isFalse(element._getEmailAddressButtonIsDisabled('test', false));
      });

      test('_getNotificationButtonIcon does return as expected', function() {
        assert.equal(element._getNotificationButtonIcon('never', false), 'social:notifications-off');
        assert.equal(element._getNotificationButtonIcon('daily', false), 'social:notifications-off');
        assert.equal(element._getNotificationButtonIcon('never', true), 'social:notifications-off');
        assert.equal(element._getNotificationButtonIcon('daily', true), 'social:notifications-active');
      });

      test('_getNotificationButtonStyleClass does return as expected', function() {
        assert.equal(element._getNotificationButtonStyleClass('never', false), '');
        assert.equal(element._getNotificationButtonStyleClass('daily', false), '');
        assert.equal(element._getNotificationButtonStyleClass('never', true), '');
        assert.equal(element._getNotificationButtonStyleClass('daily', true), 'active');
      });

      test('_getNotificationButtonText does return as expected', function() {
        assert.isString(element._getNotificationButtonText('never', false));
        assert.isString(element._getNotificationButtonText('never', true));
        assert.equal(element._getNotificationButtonText('daily', false), 'Alerts OFF (Click to Toggle ON)');
        assert.equal(element._getNotificationButtonText('daily', true), 'Alerts ON (Click to Toggle OFF)');
      });

      test('_getOpenPageButtonText does return as expected', function() {
        assert.equal(element._getOpenPageButtonText(false, 'testType', {}, 'TestType'), 'Open Saved TestType');
        assert.equal(element._getOpenPageButtonText(true, 'testType', {}, 'TestType'), 'Open Saved TestType (New Data Available)');
        assert.equal(element._getOpenPageButtonText(false, 'testType', {
          testType: {
            name: 'TestName'
          }
        }, 'TestType'), 'Open Saved TestName');
        assert.equal(element._getOpenPageButtonText(true, 'testType', {
          testType: {
            name: 'TestName'
          }
        }, 'TestType'), 'Open Saved TestName (New Data Available)');
      });

      test('_getProperty does return correctly', function() {
        assert.isUndefined(element._getProperty(null, 'a', 'b'));
        assert.isUndefined(element._getProperty({}, 'a', 'b'));
        assert.isUndefined(element._getProperty({
          a: {}
        }, 'a', 'b'));
        assert.isUndefined(element._getProperty({
          b: {}
        }, 'a', 'b'));
        assert.equal(element._getProperty({
          a: {
            b: 'test'
          }
        }, 'a', 'b'), 'test');
        assert.equal(element._getProperty({
          a: {
            b: 1234
          }
        }, 'a', 'b'), 1234);
        assert.isTrue(element._getProperty({
          a: {
            b: true
          }
        }, 'a', 'b'));
        assert.isFalse(element._getProperty({
          a: {
            b: false
          }
        }, 'a', 'b'));
        assert.deepEqual(element._getProperty({
          a: {
            b: ['test']
          }
        }, 'a', 'b'), ['test']);
        assert.deepEqual(element._getProperty({
          a: {
            b: {
              key: 'value'
            }
          }
        }, 'a', 'b'), {
          key: 'value'
        });
      });

      test('_getRunButtonText does return as expected', function() {
        assert.equal(element._getRunButtonText(true, true), 'Please Return to Search Page to Run Saved Search');
        assert.equal(element._getRunButtonText(true, false), 'Please Return to Search Page to Run Saved Search');
        assert.equal(element._getRunButtonText(false, false), 'Run Saved Search');
        assert.equal(element._getRunButtonText(false, true), 'Run Saved Search (New Data Available)');
      });

      test('_getSettingsButtonStyleClass does return as expected', function() {
        assert.equal(element._getSettingsButtonStyleClass(true), 'highlight-foreground');
        assert.equal(element._getSettingsButtonStyleClass(false), '');
      });

      test('_getSettingsButtonText does return as expected', function() {
        assert.equal(element._getSettingsButtonText(true), 'Open User Settings (You Have Alerts)');
        assert.equal(element._getSettingsButtonText(false), 'Open User Settings');
      });

      test('_getTermsDisplayCollection does a new object using buildPopupDataFunction', function() {
        assert.deepEqual(element._getTermsDisplayCollection(''), {});

        assert.deepEqual(element._getTermsDisplayCollection('{}'), {});

        assert.deepEqual(element._getTermsDisplayCollection('{\"search\":{\"a\":[]}}'), {
          x: []
        });

        assert.deepEqual(element._getTermsDisplayCollection('{\"search\":{\"a\":[1]}}'), {
          x: [1]
        });

        assert.deepEqual(element._getTermsDisplayCollection('{\"search\":{\"a\":[1],\"b\":[2,3]}}'), {
          x: [1],
          y: [2, 3]
        });

        assert.deepEqual(element._getTermsDisplayCollection('{\"search\":{\"x\":[1]}}'), {});
      });

      test('_getTermsDisplayCollection does use config', function() {
        var called = false;
        element.buildPopupDataFunction = function(searchParameters, config) {
          assert.deepEqual(config, {
            key: 'value'
          });
          called = true;
          return {};
        };

        element._getTermsDisplayCollection('{}', {
          key: 'value'
        });
        assert.isTrue(called);
      });

      test('_getViewButtonStyleClass does return as expected', function() {
        assert.equal(element._getViewButtonStyleClass(true, true), 'highlight-background');
        assert.equal(element._getViewButtonStyleClass(true, false), '');
        assert.equal(element._getViewButtonStyleClass(false, true), '');
        assert.equal(element._getViewButtonStyleClass(false, false), '');
      });

      test('_isInList does return as expected', function() {
        assert.isFalse(element._isInList(3, []));
        assert.isFalse(element._isInList(3, [1]));
        assert.isFalse(element._isInList(3, [1, 2]));
        assert.isTrue(element._isInList(3, [3]));
        assert.isTrue(element._isInList(3, [1, 3]));
        assert.isTrue(element._isInList(3, [3, 1]));
      });

      test('_openDeleteCaseDialog does open the delete dialog and set _deleteCaseIndex', function() {
        element.cases = [{
          name: 'case1',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{\"key1\":\"value1\"}}'
          }, {
            uiState: '{\"networkExpansion\":{},\"search\":{\"key2\":\"value2\"}}'
          }]
        }, {
          name: 'case2',
          searchList: [{
            uiState: '{\"networkExpansion\":{},\"search\":{\"key3\":\"value3\"}}'
          }, {
            uiState: '{\"networkExpansion\":{},\"search\":{\"key4\":\"value4\"}}'
          }]
        }];

        var called = 0;

        element._openDeleteCaseDialog({
          model: {
            caseIndex: 0
          },
          stopPropagation: function() {
            called++;
          }
        });

        assert.equal(element._deleteCaseIndex, 0);
        assert.equal(called, 1);

        var deleteDialog = element.$$('#deleteCaseDialog');
        assert(deleteDialog);
        assert.isTrue(deleteDialog.opened);
      });

      test('_openDeleteCaseDataDialog with search index does open the delete dialog and set properties', function() {
        element._openDeleteCaseDataDialog({
          model: {
            caseIndex: 0,
            searchIndex: 1
          }
        });

        assert.equal(element._deleteCaseIndex, 0);
        assert.equal(element._deleteCaseDataArray, 'searchList');
        assert.equal(element._deleteCaseDataIndex, 1);
        assert.equal(element._deleteCaseDataLabel, 'search');

        var deleteDialog = element.$$('#deleteCaseDataDialog');
        assert(deleteDialog);
        assert.isTrue(deleteDialog.opened);
      });

      test('_openDeleteCaseDataDialog with entity index does open the delete dialog and set properties', function() {
        element.dataConfig = {
          testType: {
            name: 'Test Type'
          }
        };

        element._openDeleteCaseDataDialog({
          model: {
            caseIndex: 0,
            entity: {
              type: 'testType'
            },
            entityIndex: 1
          }
        });

        assert.equal(element._deleteCaseIndex, 0);
        assert.equal(element._deleteCaseDataArray, 'entityList');
        assert.equal(element._deleteCaseDataIndex, 1);
        assert.equal(element._deleteCaseDataLabel, 'test type');

        var deleteDialog = element.$$('#deleteCaseDataDialog');
        assert(deleteDialog);
        assert.isTrue(deleteDialog.opened);
      });

      test('_openDeleteCaseDataDialog with result index does open the delete dialog and set properties', function() {
        element._openDeleteCaseDataDialog({
          model: {
            caseIndex: 0,
            resultIndex: 1
          }
        });

        assert.equal(element._deleteCaseIndex, 0);
        assert.equal(element._deleteCaseDataArray, 'resultList');
        assert.equal(element._deleteCaseDataIndex, 1);
        assert.equal(element._deleteCaseDataLabel, 'result');

        var deleteDialog = element.$$('#deleteCaseDataDialog');
        assert(deleteDialog);
        assert.isTrue(deleteDialog.opened);
      });

      test('_openPage with entity index does open the entity page', function() {
        // TODO
      });

      test('_openPage with result index does open the result page', function() {
        // TODO
      });

      test('_openSettingsDialog does open the settings dialog', function() {
        element._openSettingsDialog();
        var settingsDialog = element.$$('#settingsDialog');
        assert(settingsDialog);
        assert.isTrue(settingsDialog.opened);
      });

      test('_runSearch does set the networkExpansionParameters, notificationDate, and searchParameters and does close the settings dialog', function() {
        element.cases = [{
          name: 'case1',
          searchList: [{
            lastViewedByUser: new Date('September 01, 2017'),
            notify: true,
            uiState: '{\"networkExpansion\":{},\"search\":{}}'
          }, {
            lastViewedByUser: new Date('September 02, 2017'),
            notify: true,
            uiState: '{\"networkExpansion\":{\"a\":true},\"search\":{\"a\":[1],\"b\":[2,3]}}'
          }]
        }, {
          name: 'case2',
          searchList: [{
            lastViewedByUser: new Date('September 03, 2017'),
            notify: true,
            uiState: '{\"networkExpansion\":{},\"search\":{}}'
          }, {
            lastViewedByUser: new Date('September 04, 2017'),
            notify: true,
            uiState: '{\"networkExpansion\":{},\"search\":{}}'
          }]
        }];

        element._runSearch({
          model: {
            caseIndex: 0,
            searchIndex: 1
          }
        });

        assert.typeOf(element.cases[0].searchList[1].lastViewedByUser, 'date');
        assert.notEqual(element.cases[0].searchList[1].lastViewedByUser, new Date('September 02, 2017'));
        assert.isFalse(element.cases[0].searchList[1].notify);

        assert.deepEqual(element.cases[0].searchList[0], {
          lastViewedByUser: new Date('September 01, 2017'),
          notify: true,
          uiState: '{\"networkExpansion\":{},\"search\":{}}'
        });
        assert.deepEqual(element.cases[1].searchList[0], {
          lastViewedByUser: new Date('September 03, 2017'),
          notify: true,
          uiState: '{\"networkExpansion\":{},\"search\":{}}'
        });
        assert.deepEqual(element.cases[1].searchList[1], {
          lastViewedByUser: new Date('September 04, 2017'),
          notify: true,
          uiState: '{\"networkExpansion\":{},\"search\":{}}'
        });

        assert.deepEqual(element.notificationDate, new Date('September 02, 2017'));
        assert.isTrue(element.notifications);

        assert.deepEqual(element.networkExpansionParameters, {
          a: true
        });
        assert.deepEqual(element.searchParameters, {
          a: [1],
          b: [2, 3],
          c: [],
          startDate: 'September 02, 2017'
        });

        assert.isTrue(element.processRequest);
        assert.isFalse(element._handlingSearch);

        var settingsDialog = element.$$('#settingsDialog');
        assert(settingsDialog);
        assert.isFalse(settingsDialog.opened);
      });

      test('_runSearch does not set the notificationDate if notify is false', function() {
        element.cases = [{
          searchList: [{
            lastViewedByUser: new Date('September 01, 2017'),
            notify: false,
            uiState: '{\"networkExpansion\":{},\"search\":{\"a\":[1],\"b\":[2,3]}}'
          }]
        }];

        element._runSearch({
          model: {
            caseIndex: 0,
            searchIndex: 0
          }
        });

        assert.typeOf(element.cases[0].searchList[0].lastViewedByUser, 'date');
        assert.notEqual(element.cases[0].searchList[0].lastViewedByUser, new Date('September 01, 2017'));
        assert.isFalse(element.cases[0].searchList[0].notify);

        assert.isNull(element.notificationDate);
        assert.isFalse(element.notifications);

        assert.deepEqual(element.searchParameters, {
          a: [1],
          b: [2, 3],
          c: []
        });

        assert.isTrue(element.processRequest);
        assert.isFalse(element._handlingSearch);

        var settingsDialog = element.$$('#settingsDialog');
        assert(settingsDialog);
        assert.isFalse(settingsDialog.opened);
      });

      test('_runSearch does not set the notificationDate if notify is undefined', function() {
        element.cases = [{
          searchList: [{
            lastViewedByUser: new Date('September 01, 2017'),
            notify: undefined,
            uiState: '{\"networkExpansion\":{},\"search\":{\"a\":[1],\"b\":[2,3]}}'
          }]
        }];

        element._runSearch({
          model: {
            caseIndex: 0,
            searchIndex: 0
          }
        });

        assert.typeOf(element.cases[0].searchList[0].lastViewedByUser, 'date');
        assert.notEqual(element.cases[0].searchList[0].lastViewedByUser, new Date('September 01, 2017'));
        assert.isUndefined(element.cases[0].searchList[0].notify);

        assert.isNull(element.notificationDate);
        assert.isFalse(element.notifications);

        assert.deepEqual(element.searchParameters, {
          a: [1],
          b: [2, 3],
          c: []
        });

        assert.isTrue(element.processRequest);
        assert.isFalse(element._handlingSearch);

        var settingsDialog = element.$$('#settingsDialog');
        assert(settingsDialog);
        assert.isFalse(settingsDialog.opened);
      });

      test('_saveEmailAddress does set emailAddress to _emailInput', function() {
        element._emailInput = 'email@address.com';
        assert.equal(element.emailAddress, '');
        element._saveEmailAddress();
        assert.equal(element.emailAddress, 'email@address.com');
      });

      test('_toggleBlur does toggle blurImages', function() {
        element._toggleBlur();
        assert.isTrue(element.blurImages);

        element._toggleBlur();
        assert.isFalse(element.blurImages);
      });

      test('_toggleCase does add the caseIndex to _collapsedCases', function() {
        element._toggleCase({
          model: {
            caseIndex: 0
          }
        });

        assert.deepEqual(element._collapsedCases, [0]);

        element._toggleCase({
          model: {
            caseIndex: 1
          }
        });

        assert.deepEqual(element._collapsedCases, [0, 1]);
      });

      test('_toggleCase does remove the caseIndex from _collapsedCases', function() {
        element._collapsedCases = [0, 1];

        element._toggleCase({
          model: {
            caseIndex: 0
          }
        });

        assert.deepEqual(element._collapsedCases, [1]);

        element._toggleCase({
          model: {
            caseIndex: 1
          }
        });

        assert.deepEqual(element._collapsedCases, []);
      });

      test('_toggleEmailAlert does update search object', function() {
        element.cases = [{
          searchList: [],
          sendEmailAlert: false
        }];

        var called = 0;

        element._toggleEmailAlert({
          model: {
            caseIndex: 0
          },
          stopPropagation: function() {
            called++;
          }
        });

        assert.isTrue(element.cases[0].sendEmailAlert);
        assert.equal(called, 1);

        element._toggleEmailAlert({
          model: {
            caseIndex: 0
          },
          stopPropagation: function() {
            called++;
          }
        });

        assert.isFalse(element.cases[0].sendEmailAlert);
        assert.equal(called, 2);
      });

      test('_updateEmailInput does update _emailInput', function() {
        element._updateEmailInput('abc@xyz.com');
        assert.equal(element._emailInput, 'abc@xyz.com');
      });

      test('_updateNotifications does update notifications', function() {
        element.cases = [{
          searchList: [{
            notify: true
          }]
        }];
        element._updateNotifications();
        assert.isTrue(element.notifications);

        element.cases = [{
          searchList: [{
            notify: false
          }]
        }];
        element._updateNotifications();
        assert.isFalse(element.notifications);

        element.cases = [{
          searchList: [{
            notify: false
          }, {
            notify: true
          }]
        }];
        element._updateNotifications();
        assert.isTrue(element.notifications);

        element.cases = [{
          searchList: [{
            notify: false
          }]
        }, {
          searchList: [{
            notify: false
          }]
        }];
        element._updateNotifications();
        assert.isFalse(element.notifications);

        element.cases = [{
          searchList: [{
            notify: false
          }]
        }, {
          searchList: [{
            notify: true
          }]
        }];
        element._updateNotifications();
        assert.isTrue(element.notifications);

        element.cases = [{
          searchList: [{
            notify: undefined
          }]
        }];
        element._updateNotifications();
        assert.isFalse(element.notifications);
      });

      test('_updateNotificationDate does update notificationDate and cases', function() {
        element.cases = [{
          searchList: [{
            lastViewedByUser: new Date('September 01, 2017'),
            notify: true
          }, {
            lastViewedByUser: new Date('September 02, 2017'),
            notify: true
          }]
        }, {
          searchList: [{
            lastViewedByUser: new Date('September 03, 2017'),
            notify: true
          }, {
            lastViewedByUser: new Date('September 04, 2017'),
            notify: true
          }]
        }];

        element._updateNotificationDate(0, 'searchList', 1);

        assert.deepEqual(element.notificationDate, new Date('September 02, 2017'));

        assert.typeOf(element.cases[0].searchList[1].lastViewedByUser, 'date');
        assert.notEqual(element.cases[0].searchList[1].lastViewedByUser, new Date('September 02, 2017'));
        assert.isFalse(element.cases[0].searchList[1].notify);

        assert.deepEqual(element.cases[0].searchList[0], {
          lastViewedByUser: new Date('September 01, 2017'),
          notify: true
        });
        assert.deepEqual(element.cases[1].searchList[0], {
          lastViewedByUser: new Date('September 03, 2017'),
          notify: true
        });
        assert.deepEqual(element.cases[1].searchList[1], {
          lastViewedByUser: new Date('September 04, 2017'),
          notify: true
        });
      });

      test('_updateNotificationDate does set notificationDate to null if notify is true', function() {
        element.notificationDate = new Date('September 01, 2017');

        element.cases = [{
          searchList: [{
            lastViewedByUser: new Date('September 02, 2017'),
            notify: false
          }]
        }];

        element._updateNotificationDate(0, 'searchList', 0);

        assert.isNull(element.notificationDate);

        assert.typeOf(element.cases[0].searchList[0].lastViewedByUser, 'date');
        assert.notEqual(element.cases[0].searchList[0].lastViewedByUser, new Date('September 02, 2017'));
        assert.isFalse(element.cases[0].searchList[0].notify);
      });

      test('_updateNotificationDate does set notificationDate to null if notify is undefined', function() {
        element.notificationDate = new Date('September 01, 2017');

        element.cases = [{
          searchList: [{
            lastViewedByUser: new Date('September 02, 2017'),
            notify: undefined
          }]
        }];

        element._updateNotificationDate(0, 'searchList', 0);

        assert.isNull(element.notificationDate);

        assert.typeOf(element.cases[0].searchList[0].lastViewedByUser, 'date');
        assert.notEqual(element.cases[0].searchList[0].lastViewedByUser, new Date('September 02, 2017'));
        assert.isUndefined(element.cases[0].searchList[0].notify);
      });

      test('setting cases does update notifications', function() {
        assert.isFalse(element.notifications);

        element.cases = [{
          searchList: [{
            notify: true
          }]
        }];

        assert.isTrue(element.notifications);
      });

      test('setting emailAddress does update _emailInput', function() {
        assert.equal(element._emailInput, '');
        element.emailAddress = 'abc@xyz.com';
        assert.equal(element._emailInput, 'abc@xyz.com');
      });
    });
  </script>
</body>
</html>
